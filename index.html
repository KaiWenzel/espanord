<!DOCTYPE html>
<html lang="en">
<head>
    <title>Redirecting...</title>
    
    <script>
        !function(e){if(!window.pintrk){window.pintrk = function () {
        window.pintrk.queue.push(Array.prototype.slice.call(arguments))};var
          n=window.pintrk;n.queue=[],n.version="3.0";var
          t=document.createElement("script");t.async=!0,t.src=e;var
          r=document.getElementsByTagName("script")[0];
          r.parentNode.insertBefore(t,r)}}("https://s.pinimg.com/ct/core.js");
        // NOTE: The 'em' (email) parameter should be removed or dynamically set.
        pintrk('load', '2612894781060'); 
        pintrk('page'); // Initial page view signal
    </script>
    <noscript>
        <img height="1" width="1" style="display:none;" alt=""
          src="https://ct.pinterest.com/v3/?event=init&tid=2612894781060&noscript=1" />
    </noscript>
    <script>
        // --- CONFIGURATION ---
        const COOKIE_NAME = 'campaign_ad_id';
        const discordURL = "https://discord.gg/VydqsnRPRg";
        const FINAL_DELAY_MS = 1000; // Increased delay to 1 full second for reliable conversion firing

        // Helper function to read a cookie by name
        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // Helper function to delete a cookie
        function deleteCookie(name) {
            // Ensure the domain is correct for deletion
            document.cookie = name + '=; domain=.xn--espaord-7za.com; path=/; max-age=0; secure; samesite=Lax'; 
            console.log(`[Destination]: Cookie deleted: ${name}`);
        }

        // Execute tracking and redirect immediately (no need to wait for full window load)
        (function fireSignupAndRedirect() {
            let adId = getCookie(COOKIE_NAME);
            let eventData = {};
            
            if (adId) {
                // FIX: Use 'epk' for attribution instead of 'ad_id'
                eventData = { epk: adId };
                console.log(`[Destination]: Retrieved Ad ID from cookie and using EPK: ${adId}`);
                
                // Delete the cookie immediately after reading
                deleteCookie(COOKIE_NAME); 
            } else {
                console.log("[Destination]: No Ad ID cookie found. Firing 'signup' without attribution.");
            }

            // FIRE THE SPECIFIC CONVERSION EVENT
            if (window.pintrk) {
                pintrk('track', 'signup', eventData); 
                console.log("[Destination]: Pinterest 'signup' event fired.");
            }
            
            // Wait a full second before redirecting
            setTimeout(function() {
                window.location.replace(discordURL);
            }, FINAL_DELAY_MS); 
        })();
    </script>
</head>
<body>
    <p>Loading your Discord invite...</p>
    <noscript>
        <p>If you are not redirected, please <a href="https://discord.gg/VydqsnRPRg">click here</a>.</p>
    </noscript>
</body>
</html>
